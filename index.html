<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change The Channel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <meta name="theme-color" content="#000000">
  <style>
    #emulator-container {
      width: 100%;
      height: 100%;
      min-height: 600px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const PixelClock = () => {
      const [time, setTime] = useState(new Date());

      useEffect(() => {
        const timer = setInterval(() => {
          setTime(new Date());
        }, 1000);
        return () => clearInterval(timer);
      }, []);

      const formatTime = () => {
        return time.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          second: '2-digit',
          hour12: true 
        });
      };

      return (
        <div className="flex items-center gap-2 bg-gray-900 px-4 py-2 rounded border-2 border-green-500">
          <div className="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
          <span className="text-green-400 font-mono text-lg font-bold tracking-wider">
            {formatTime()}
          </span>
        </div>
      );
    };

    const Play = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polygon points="5 3 19 12 5 21 5 3"/>
      </svg>
    );

    const Tv = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect width="20" height="15" x="2" y="7" rx="2" ry="2"/>
        <polyline points="17 2 12 7 7 2"/>
      </svg>
    );

    const Power = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 2v10"/>
        <path d="M18.4 6.6a9 9 0 1 1-12.77.04"/>
      </svg>
    );

    const Maximize = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M8 3H5a2 2 0 0 0-2 2v3"/>
        <path d="M21 8V5a2 2 0 0 0-2-2h-3"/>
        <path d="M3 16v3a2 2 0 0 0 2 2h3"/>
        <path d="M16 21h3a2 2 0 0 0 2-2v-3"/>
      </svg>
    );

    const Gamepad2 = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="6" x2="10" y1="12" y2="12"/>
        <line x1="8" x2="8" y1="10" y2="14"/>
        <line x1="15" x2="15.01" y1="13" y2="13"/>
        <line x1="18" x2="18.01" y1="11" y2="11"/>
        <rect width="20" height="12" x="2" y="6" rx="2"/>
      </svg>
    );

    const Upload = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" x2="12" y1="3" y2="15"/>
      </svg>
    );

    const X = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" x2="6" y1="6" y2="18"/>
        <line x1="6" x2="18" y1="6" y2="18"/>
      </svg>
    );

    const Trash2 = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"/>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        <line x1="10" x2="10" y1="11" y2="17"/>
        <line x1="14" x2="14" y1="11" y2="17"/>
      </svg>
    );

    const PLATFORMS = {
      NES: { name: 'NES', ext: ['.nes', '.zip'], description: 'Nintendo Entertainment System', core: 'nes' },
      SNES: { name: 'SNES', ext: ['.smc', '.sfc', '.zip'], description: 'Super Nintendo', core: 'snes' },
      GEN: { name: 'Genesis', ext: ['.md', '.gen', '.zip'], description: 'Sega Genesis', core: 'segaMD' },
      GB: { name: 'Game Boy', ext: ['.gb', '.gbc', '.zip'], description: 'Game Boy/Color', core: 'gb' },
      GBA: { name: 'GBA', ext: ['.gba', '.zip'], description: 'Game Boy Advance', core: 'gba' }
    };

    const EmulatorContainer = ({ game }) => {
      const [error, setError] = useState(null);
      const [loading, setLoading] = useState(true);
      const containerIdRef = useRef(`emulator-${Date.now()}`);

      useEffect(() => {
        if (!game) return;

        const platformMap = {
          'NES': 'nes',
          'SNES': 'snes',
          'Genesis': 'segaMD',
          'Game Boy': 'gb',
          'GBA': 'gba'
        };

        const core = platformMap[game.platform];
        if (!core) {
          setError('Unsupported platform: ' + game.platform);
          setLoading(false);
          return;
        }

        let blobUrl = null;
        let scriptElement = null;

        const initEmulator = async () => {
          try {
            console.log('üéÆ Starting emulator initialization...', {
              platform: game.platform,
              core: core,
              name: game.name,
              dataSize: game.data.byteLength
            });

            const blob = new Blob([game.data], { type: 'application/octet-stream' });
            blobUrl = URL.createObjectURL(blob);
            console.log('‚úÖ Blob URL created:', blobUrl);

            const container = document.getElementById(containerIdRef.current);
            if (container) {
              container.innerHTML = '';
              console.log('‚úÖ Container cleared');
            }

            // Remove old EmulatorJS script
            const oldScript = document.querySelector('script[src*="EmulatorJS"]');
            if (oldScript) {
              oldScript.remove();
              console.log('üóëÔ∏è Removed old emulator script');
            }

            // Clear old globals
            delete window.EJS_player;
            delete window.EJS_core;
            delete window.EJS_gameName;
            delete window.EJS_gameUrl;

            // Set new config
            window.EJS_player = `#${containerIdRef.current}`;
            window.EJS_core = core;
            window.EJS_gameName = game.name;
            window.EJS_gameUrl = blobUrl;
            window.EJS_pathtodata = 'https://cdn.jsdelivr.net/gh/EmulatorJS/EmulatorJS@latest/data/';
            window.EJS_color = '#6B21A8';
            window.EJS_startOnLoaded = true;

            console.log('‚úÖ EmulatorJS config set:', {
              player: window.EJS_player,
              core: window.EJS_core,
              gameUrl: window.EJS_gameUrl
            });

            // Load EmulatorJS
            scriptElement = document.createElement('script');
            scriptElement.src = 'https://cdn.jsdelivr.net/gh/EmulatorJS/EmulatorJS@latest/data/loader.js';
            
            scriptElement.onload = () => {
              console.log('‚úÖ EmulatorJS script loaded successfully');
              setTimeout(() => setLoading(false), 2000);
            };

            scriptElement.onerror = (e) => {
              console.error('‚ùå Failed to load EmulatorJS script:', e);
              setError('Failed to load emulator. Please try again.');
              setLoading(false);
            };

            document.body.appendChild(scriptElement);
            console.log('üì¶ EmulatorJS script added to page');

          } catch (err) {
            console.error('‚ùå Emulator initialization error:', err);
            setError('Failed to initialize: ' + err.message);
            setLoading(false);
          }
        };

        initEmulator();

        return () => {
          console.log('üßπ Cleaning up emulator...');
          if (blobUrl) {
            URL.revokeObjectURL(blobUrl);
          }
          
          if (scriptElement && scriptElement.parentNode) {
            scriptElement.remove();
          }

          const container = document.getElementById(containerIdRef.current);
          if (container) {
            container.innerHTML = '';
          }

          delete window.EJS_player;
          delete window.EJS_core;
          delete window.EJS_gameName;
          delete window.EJS_gameUrl;
        };
      }, [game]);

      if (error) {
        return (
          <div className="w-full h-full bg-gray-950 rounded-lg border-4 border-red-600 flex items-center justify-center">
            <div className="text-center text-red-400 font-mono p-8">
              <p className="text-2xl mb-4">‚ö†Ô∏è</p>
              <p className="mb-2 text-lg">Error Loading Game</p>
              <p className="text-sm mb-4">{error}</p>
              <p className="text-xs text-gray-500">Platform: {game.platform}</p>
              <p className="text-xs text-gray-500 mt-2">File: {game.name}</p>
              <p className="text-xs text-gray-600 mt-4">Make sure you uploaded a valid ROM file</p>
            </div>
          </div>
        );
      }

      return (
        <div className="w-full h-full bg-black rounded-lg border-4 border-purple-600 overflow-hidden relative" style={{ minHeight: '600px' }}>
          <div id={containerIdRef.current} className="w-full h-full" style={{ minHeight: '600px' }}></div>
          {loading && (
            <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-90 z-50">
              <div className="text-center text-purple-400 font-mono">
                <div className="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p className="text-xl mb-2">Loading Emulator...</p>
                <p className="text-sm text-gray-400 mt-2">{game.name}</p>
                <p className="text-xs text-gray-500 mt-1">Platform: {game.platform}</p>
                <p className="text-xs text-gray-600 mt-4">Check browser console (F12) for details</p>
              </div>
            </div>
          )}
        </div>
      );
    };

    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [currentChannel, setCurrentChannel] = useState(1);
      const [tvOn, setTvOn] = useState(false);
      const [showChannelInfo, setShowChannelInfo] = useState(false);
      const [rolledUsername, setRolledUsername] = useState('');
      const [rolledPassword, setRolledPassword] = useState('');
      const [isRollingUser, setIsRollingUser] = useState(false);
      const [isRollingPass, setIsRollingPass] = useState(false);
      const [showArcade, setShowArcade] = useState(false);
      const [arcadeView, setArcadeView] = useState('library');
      const [selectedArcadePlatform, setSelectedArcadePlatform] = useState(null);
      const [arcadeGames, setArcadeGames] = useState({});
      const [uploadProgress, setUploadProgress] = useState(0);
      const [runningGame, setRunningGame] = useState(null);
      const containerRef = useRef(null);
      const channelVideoRefs = useRef({});
      const fileInputRef = useRef(null);
      const [channelStates, setChannelStates] = useState({
        1: { videoIndex: 0, key: 0 },
        2: { videoIndex: 0, key: 0 },
        3: { videoIndex: 0, key: 0 },
        4: { videoIndex: 0, key: 0 },
      });

      const channels = [
        {
          id: 1,
          name: 'NICKELODEON',
          videos: [
            'https://www.dropbox.com/scl/fi/0qhbxc2b1owo9sxcxa0jd/nick-halloween-block.mp4?rlkey=xly50ft4owo9zv45atkvonbzu&st=7fzpqayr&raw=1',
            'https://www.dropbox.com/scl/fi/0kx6kuhz626w2ff5otupp/716-1.mp4?rlkey=yna7t1kngnjopq9rwo0mej2dt&st=sju64tr4&raw=1',
            'https://www.dropbox.com/scl/fi/t5pgzd4lqd10pmcnfi5su/Spongebob-The-Sponge-Who-Could-Fly.mp4?rlkey=qzvvvdihnqa82glbn2uy2ve3c&st=p9ywopri&raw=1'
          ],
          schedule: [
            { title: 'Nick Halloween', hour: 12, minute: 0, videoIndex: 0 },
            { title: 'SpongeBash Special', hour: 2, minute: 45, videoIndex: 1 },
            { title: 'The Sponge Who Could Fly', hour: 4, minute: 45, videoIndex: 2 }
          ]
        },
        {
          id: 2,
          name: 'CARTOON NETWORK',
          videos: [
            'https://www.dropbox.com/scl/fi/v88t8aoxt17uh1pqo42ch/live_user_livetoons10_1357606766.flv.mp4?rlkey=6w7m1ee8qfwstww3m8g25hmin&st=plw085je&raw=1',
            'https://www.dropbox.com/scl/fi/wztbfclfemuhwyzmns5sr/live_user_livetoons10_1358211514.mp4?rlkey=6qbndxzqlwz3w2js4ggim7us2&st=oaxb01u2&raw=1'
          ],
          schedule: [
            { title: 'Regular Show', hour: 12, minute: 0, videoIndex: 0 },
            { title: 'Regular Show', hour: 12, minute: 30, videoIndex: 1 }
          ]
        }
      ];

      const rollUsername = () => {
        setIsRollingUser(true);
        let count = 0;
        const interval = setInterval(() => {
          const randomNum = Math.floor(Math.random() * 99) + 1;
          setRolledUsername(`user${randomNum}`);
          count++;
          if (count >= 20) {
            clearInterval(interval);
            setIsRollingUser(false);
          }
        }, 50);
      };

      const rollPassword = () => {
        setIsRollingPass(true);
        let count = 0;
        const interval = setInterval(() => {
          const randomPass = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
          setRolledPassword(randomPass);
          count++;
          if (count >= 20) {
            clearInterval(interval);
            setIsRollingPass(false);
          }
        }, 50);
      };

      const handleLogin = () => {
        if (username === rolledUsername && password === rolledPassword) {
          setIsLoggedIn(true);
        } else {
          alert('Invalid credentials. Please use the rolled username and password.');
        }
      };

      const handleChannelChange = (channelId) => {
        setCurrentChannel(channelId);
        setShowChannelInfo(true);
      };

      const togglePower = () => {
        setTvOn(!tvOn);
      };

      const handleVideoEnd = (channelId) => {
        const channel = channels.find(ch => ch.id === channelId);
        const nextIndex = (channelStates[channelId].videoIndex + 1) % channel.videos.length;
        setChannelStates(prev => ({
          ...prev,
          [channelId]: {
            videoIndex: nextIndex,
            key: prev[channelId].key + 1
          }
        }));
      };

      const handleFileUploadArcade = (e, platformKey) => {
        const files = Array.from(e.target.files);
        const platform = PLATFORMS[platformKey];
        
        console.log('üìÅ Uploading files:', files.map(f => f.name));
        
        files.forEach(file => {
          setUploadProgress(50);
          const reader = new FileReader();
          reader.onload = (event) => {
            const gameData = {
              name: file.name,
              platform: platform.name,
              platformKey: platformKey,
              data: event.target.result,
              id: `${platformKey}-${Date.now()}-${Math.random()}`
            };
            console.log('‚úÖ Game uploaded:', gameData.name, 'Size:', gameData.data.byteLength, 'bytes');
            setArcadeGames(prev => ({
              ...prev,
              [platformKey]: [...(prev[platformKey] || []), gameData]
            }));
            setUploadProgress(100);
            setTimeout(() => setUploadProgress(0), 1000);
          };
          reader.readAsArrayBuffer(file);
        });
        if (fileInputRef.current) fileInputRef.current.value = '';
      };

      const deleteArcadeGame = (gameId) => {
        setArcadeGames(prev => {
          const updated = { ...prev };
          Object.keys(updated).forEach(platform => {
            updated[platform] = updated[platform].filter(g => g.id !== gameId);
            if (updated[platform].length === 0) delete updated[platform];
          });
          return updated;
        });
      };

      const launchArcadeGame = (game) => {
        console.log('üöÄ Launching game:', game.name);
        setRunningGame(game);
        setArcadeView('playing');
      };

      const closeArcadeGame = () => {
        setRunningGame(null);
        setArcadeView('library');
      };

      useEffect(() => {
        if (tvOn) {
          Object.keys(channelVideoRefs.current).forEach(channelId => {
            const video = channelVideoRefs.current[channelId];
            if (video) {
              video.play().catch(err => console.log('Play prevented:', err));
            }
          });
        } else {
          Object.keys(channelVideoRefs.current).forEach(channelId => {
            const video = channelVideoRefs.current[channelId];
            if (video) {
              video.pause();
            }
          });
        }
      }, [tvOn]);

      useEffect(() => {
        if (showChannelInfo) {
          const timer = setTimeout(() => {
            setShowChannelInfo(false);
          }, 5000);
          return () => clearTimeout(timer);
        }
      }, [showChannelInfo]);

      if (!isLoggedIn) {
        return (
          <div className="min-h-screen bg-black flex items-center justify-center p-4">
            <div className="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-md border-4 border-gray-700">
              <div className="flex items-center justify-center mb-6">
                <div className="w-16 h-16 text-blue-400"><Tv /></div>
              </div>
              <h1 className="text-3xl font-bold text-center mb-2 text-blue-300 font-mono">CHANGE THE CHANNEL</h1>
              <p className="text-center text-gray-400 mb-6 text-sm">Streaming Network</p>
              
              <div className="space-y-6 mb-6">
                <div className="bg-gray-900 p-4 rounded-lg border-2 border-blue-500">
                  <h3 className="text-blue-300 font-mono text-sm mb-3 text-center">ROLL YOUR CREDENTIALS</h3>
                  
                  <div className="space-y-3">
                    <div className="flex items-center gap-3">
                      <button
                        onClick={rollUsername}
                        disabled={isRollingUser}
                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white font-mono text-sm rounded transition-colors"
                      >
                        üé≤ ROLL USER
                      </button>
                      <div className="flex-1 px-3 py-2 bg-black border border-blue-500 rounded text-green-400 font-mono text-sm">
                        {rolledUsername || 'user??'}
                      </div>
                    </div>

                    <div className="flex items-center gap-3">
                      <button
                        onClick={rollPassword}
                        disabled={isRollingPass}
                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white font-mono text-sm rounded transition-colors"
                      >
                        üé≤ ROLL PASS
                      </button>
                      <div className="flex-1 px-3 py-2 bg-black border border-blue-500 rounded text-green-400 font-mono text-sm">
                        {rolledPassword || '????'}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-blue-300 mb-2 font-mono text-sm">USERNAME</label>
                  <input
                    type="text"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                    className="w-full px-4 py-2 bg-gray-900 border-2 border-blue-500 rounded text-blue-300 focus:outline-none focus:border-blue-400 font-mono"
                    placeholder="Enter rolled username"
                  />
                </div>
                <div>
                  <label className="block text-blue-300 mb-2 font-mono text-sm">PASSWORD</label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                    className="w-full px-4 py-2 bg-gray-900 border-2 border-blue-500 rounded text-blue-300 focus:outline-none focus:border-blue-400 font-mono"
                    placeholder="Enter rolled password"
                  />
                </div>
                <button
                  onClick={handleLogin}
                  className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded font-mono transition-colors"
                >
                  SIGN IN
                </button>
              </div>
            </div>
          </div>
        );
      }

      if (showArcade && arcadeView === 'playing') {
        return (
          <div className="fixed inset-0 bg-black z-50 flex flex-col">
            <div className="bg-gray-900 border-b-2 border-purple-600 p-4 flex justify-between items-center">
              <div className="flex items-center gap-3">
                <div className="w-6 h-6 text-purple-400"><Gamepad2 /></div>
                <span className="text-white font-mono font-bold">{runningGame.name}</span>
                <span className="text-gray-500 font-mono text-sm">({runningGame.platform})</span>
              </div>
              <button
                onClick={closeArcadeGame}
                className="p-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors"
              >
                <div className="w-6 h-6"><X /></div>
              </button>
            </div>
            <div className="flex-1 flex items-center justify-center bg-black p-4">
              <EmulatorContainer game={runningGame} />
            </div>
          </div>
        );
      }

      if (showArcade) {
        return (
          <div className="fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-4 overflow-y-auto">
            <div className="bg-gray-900 rounded-lg border-4 border-purple-600 p-8 max-w-6xl w-full my-8">
              <div className="flex justify-between items-center mb-8">
                <h2 className="text-3xl font-bold text-white font-mono flex items-center gap-3">
                  <div className="w-8 h-8 text-purple-400"><Gamepad2 /></div>
                  ARCADE LIBRARY
                </h2>
                <button
                  onClick={() => setShowArcade(false)}
                  className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-mono transition-colors"
                >
                  CLOSE
                </button>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-5 gap-4 mb-8">
                {Object.entries(PLATFORMS).map(([key, platform]) => (
                  <button
                    key={key}
                    onClick={() => setSelectedArcadePlatform(key)}
                    className={`p-4 rounded-lg border-2 transition-all font-mono ${
                      selectedArcadePlatform === key
                        ? 'border-purple-500 bg-purple-900 text-white shadow-lg shadow-purple-500/50'
                        : 'border-gray-700 bg-gray-800 text-gray-300 hover:border-gray-600'
                    }`}
                  >
                    <p className="font-bold text-lg">{platform.name}</p>
                    <p className="text-xs opacity-70">{platform.ext.join(', ')}</p>
                  </button>
                ))}
              </div>

              {selectedArcadePlatform && (
                <div className="bg-gray-800 rounded-lg border-2 border-gray-700 p-6 mb-8">
                  <div className="flex items-center justify-between mb-6">
                    <h2 className="text-2xl font-bold text-white font-mono">
                      {PLATFORMS[selectedArcadePlatform].name} - Upload Games
                    </h2>
                    <label className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded font-mono cursor-pointer flex items-center gap-2 transition-colors">
                      <div className="w-5 h-5"><Upload /></div>
                      UPLOAD ROM
                      <input
                        ref={fileInputRef}
                        type="file"
                        multiple
                        onChange={(e) => handleFileUploadArcade(e, selectedArcadePlatform)}
                        className="hidden"
                        accept={PLATFORMS[selectedArcadePlatform].ext.join(',')}
                      />
                    </label>
                  </div>

                  {uploadProgress > 0 && (
                    <div className="mb-4 bg-gray-700 rounded-full h-2 overflow-hidden">
                      <div
                        className="bg-purple-500 h-full transition-all duration-300"
                        style={{ width: `${uploadProgress}%` }}
                      />
                    </div>
                  )}

                  <div className="space-y-2">
                    {arcadeGames[selectedArcadePlatform] && arcadeGames[selectedArcadePlatform].length > 0 ? (
                      arcadeGames[selectedArcadePlatform].map(game => (
                        <div
                          key={game.id}
                          className="bg-gray-700 rounded p-4 flex items-center justify-between hover:bg-gray-600 transition-colors"
                        >
                          <div className="flex-1">
                            <p className="text-white font-mono font-bold">{game.name}</p>
                            <p className="text-gray-300 text-sm font-mono">Ready to play ‚Ä¢ {(game.data.byteLength / 1024 / 1024).toFixed(2)} MB</p>
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => launchArcadeGame(game)}
                              className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-mono flex items-center gap-2 transition-colors"
                            >
                              <div className="w-4 h-4"><Play /></div>
                              PLAY
                            </button>
                            <button
                              onClick={() => deleteArcadeGame(game.id)}
                              className="px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded font-mono transition-colors flex items-center gap-1"
                            >
                              <div className="w-4 h-4"><Trash2 /></div>
                            </button>
                          </div>
                        </div>
                      ))
                    ) : (
                      <div className="text-center py-8 text-gray-400 font-mono">
                        <p className="text-lg mb-2">No games uploaded for {PLATFORMS[selectedArcadePlatform].name}</p>
                        <p className="text-sm">Upload {PLATFORMS[selectedArcadePlatform].ext.join(' or ')} files above</p>
                        <p className="text-xs mt-4 text-gray-500">üí° Tip: You need to provide your own ROM files</p>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {Object.keys(arcadeGames).length > 0 && (
                <div>
                  <h2 className="text-2xl font-bold text-white font-mono mb-4">ALL GAMES ({Object.values(arcadeGames).flat().length})</h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    {Object.entries(arcadeGames).map(([platform, gameList]) =>
                      gameList.map(game => (
                        <div key={game.id} className="bg-gray-800 rounded-lg border-2 border-gray-700 p-4 hover:border-purple-500 transition-colors">
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex-1">
                              <p className="text-purple-400 font-mono text-xs font-bold">{game.platform}</p>
                              <p className="text-white font-mono text-sm font-bold truncate">{game.name}</p>
                            </div>
                          </div>
                          <button
                            onClick={() => launchArcadeGame(game)}
                            className="w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-mono text-sm flex items-center justify-center gap-2 transition-colors"
                          >
                            <div className="w-4 h-4"><Play /></div>
                            PLAY
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-black p-8 flex flex-col">
          <div className="max-w-7xl mx-auto w-full flex-1">
            <div className="flex justify-between items-center mb-8">
              <h1 className="text-4xl font-bold text-white font-mono flex items-center gap-3">
                <div className="w-10 h-10"><Tv /></div>
                CHANGE THE CHANNEL
              </h1>
              <div className="flex items-center gap-4">
                <PixelClock />
                <button
                  onClick={() => setShowArcade(!showArcade)}
                  className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded font-mono transition-colors flex items-center gap-2"
                >
                  <div className="w-5 h-5"><Gamepad2 /></div>
                  ARCADE
                </button>
                <button
                  onClick={() => setIsLoggedIn(false)}
                  className="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded font-mono transition-colors"
                >
                  LOGOUT
                </button>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              <div className="lg:col-span-2">
                <div className="bg-black p-4 rounded-lg shadow-2xl border-4 border-gray-800">
                  <div className="bg-black rounded-lg overflow-hidden relative" style={{ paddingBottom: '56.25%' }} ref={containerRef}>
                    {tvOn ? (
                      <>
                        {channels.map((channel) => {
                          const videoUrl = channel.videos[channelStates[channel.id].videoIndex];
                          const isVisible = channel.id === currentChannel;
                          return (
                            <video
                              key={`${channel.id}-${channelStates[channel.id].key}`}
                              ref={(el) => {
                                if (el) channelVideoRefs.current[channel.id] = el;
                              }}
                              className={`absolute top-0 left-0 w-full h-full object-cover ${isVisible ? 'z-10' : 'z-0 opacity-0 pointer-events-none'}`}
                              playsInline
                              preload="auto"
                              src={videoUrl}
                              muted={!isVisible}
                              onEnded={() => handleVideoEnd(channel.id)}
                              onCanPlay={(e) => {
                                if (tvOn) {
                                  e.target.play().catch(err => console.log('Play prevented:', err));
                                }
                              }}
                            />
                          );
                        })}
                      </>
                    ) : (
                      <div className="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-950"></div>
                    )}
                    
                    {showChannelInfo && (
                      <div className="absolute bottom-16 left-4 bg-black bg-opacity-70 px-4 py-2 rounded pointer-events-none z-10">
                        <p className="text-green-400 font-mono text-sm">CH {currentChannel}</p>
                        <p className="text-green-400 font-mono text-xs">{channels.find(c => c.id === currentChannel)?.name}</p>
                      </div>
                    )}
                  </div>
                  
                  <div className="mt-6 flex justify-center gap-4">
                    <button
                      onClick={togglePower}
                      className={`p-4 rounded-full transition-all ${
                        tvOn 
                          ? 'bg-green-600 hover:bg-green-700 shadow-lg shadow-green-500/50' 
                          : 'bg-red-600 hover:bg-red-700 shadow-lg shadow-red-500/50'
                      }`}
                    >
                      <div className="w-6 h-6 text-white"><Power /></div>
                    </button>
                  </div>
                </div>
              </div>

              <div className="space-y-4">
                <h2 className="text-2xl font-bold text-white font-mono mb-4">CHANNELS</h2>
                {channels.map((channel) => (
                  <button
                    key={channel.id}
                    onClick={() => handleChannelChange(channel.id)}
                    className={`w-full p-4 rounded-lg font-mono transition-all ${
                      currentChannel === channel.id
                        ? 'bg-white text-black shadow-lg shadow-white/50'
                        : 'bg-gray-800 text-white hover:bg-gray-700 hover:shadow-lg hover:shadow-white/30'
                    }`}
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-left">
                        <p className="font-bold text-lg">{channel.name}</p>
                      </div>
                      <div className="text-3xl font-bold">{channel.id}</div>
                    </div>
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>